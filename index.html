<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Trang Sá»± Kiá»‡n</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="user.css">
  <link rel="stylesheet" href="qlsk.css">
</head>
<body>
<header>
  <div class="logo-area">
    <img src="https://haitrieu.com/wp-content/uploads/2021/10/Logo-Hoc-Vien-Cong-Nghe-Buu-Chinh-Vien-Thong-PTITSimple-635x807.png" alt="PTIT Logo">
    <div class="logo-text">Há»ŒC VIá»†N CÃ”NG NGHá»†<br><span>BÆ¯U CHÃNH VIá»„N THÃ”NG</span></div>
  </div>
  <nav>
    <div class="active"><a href="https://n23dcpt048-del.github.io/test/">TRANG CHá»¦</a></div>

    <a href="lienhe.html">LIÃŠN Há»†</a>
  </nav>
  <div class="auth"><a href="login.html">ÄÄ‚NG NHáº¬P</a></div>
</header>

<section class="hero">
  <h1>CHÃY CÃ™NG PTIT!</h1>
  <p>Sáºµn sÃ ng bÃ¹ng ná»• trong má»i sá»± kiá»‡n sinh viÃªn</p>
</section>

<main class="user-main">
  <h2>Danh sÃ¡ch sá»± kiá»‡n</h2>

  <section class="admin-card-wrapper">
    <div class="event-card" id="events-container">
      <p style="text-align:center; color:#888; grid-column:1/-1; padding:60px;">
        Äang táº£i danh sÃ¡ch sá»± kiá»‡n...
      </p>
    </div>
  </section>
</main>

<footer>
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <h3>Trá»¥ sá»Ÿ chÃ­nh</h3>
        <p>Sá»‘ 122 HoÃ ng Quá»‘c Viá»‡t, phÆ°á»ng NghÄ©a ÄÃ´, thÃ nh phá»‘ HÃ  Ná»™i.</p>
        <p>CÆ¡ sá»Ÿ Ä‘Ã o táº¡o táº¡i HÃ  Ná»™i<br>Sá»‘ 964 Tiáº¿n PhÃº, phÆ°á»ng HÃ  ÄÃ´ng, thÃ nh phá»‘ HÃ  Ná»™i.</p>
      </div>

      <div class="footer-section" id="social-media-col">
        <h3>Máº¡ng xÃ£ há»™i</h3>
        <p style="color:#888; font-style:italic;">Äang táº£i...</p>
      </div>

      <div class="footer-section">
        <h3>Há»c viá»‡n cÆ¡ sá»Ÿ táº¡i TP Há»“ ChÃ­ Minh</h3>
        <p>Sá»‘ 11 Nguyá»…n ÄÃ¬nh Chiá»ƒu, phÆ°á»ng SÃ i GÃ²n, ThÃ nh phá»‘ Há»“ ChÃ­ Minh.</p>
        <p>CÆ¡ sá»Ÿ Ä‘Ã o táº¡o táº¡i TP Há»“ ChÃ­ Minh<br>Sá»‘ 97 Nam Thiá»‡n, phÆ°á»ng TÄƒng NhÆ¡n PhÃº, thÃ nh phá»‘ Há»“ ChÃ­ Minh.</p>
      </div>

      <div class="footer-section" id="contact-info-col">
        <h3>ThÃ´ng tin liÃªn láº¡c</h3>
        <ul>
          <li>ğŸ“§ Email: <span id="footer-email">Äang táº£i...</span></li>
          <li>ğŸ“ Sá»‘ Ä‘iá»‡n thoáº¡i: <span id="footer-phone">Äang táº£i...</span></li>
          <li>ğŸ“ Äá»‹a chá»‰: <span id="footer-address">Äang táº£i...</span></li>
        </ul>
      </div>
    </div>

    <div class="footer-bottom">
      <p>&copy; 2025 Há»c Viá»‡n CÃ´ng Nghá»‡ BÆ°u ChÃ­nh Viá»…n ThÃ´ng. Táº¥t cáº£ cÃ¡c quyá»n Ä‘Æ°á»£c báº£o lÆ°u.</p>
    </div>
  </div>
</footer>

<script>
  const API_BASE = 'https://test4-7cop.onrender.com';
  const EVENTS_API = `${API_BASE}/api/events`;
  const SOCIAL_API = `${API_BASE}/api/social-medias`;
  const CONTACT_API = `${API_BASE}/api/contact`;

  // Kiá»ƒm tra sá»± kiá»‡n cÃ²n háº¡n hay háº¿t háº¡n dá»±a trÃªn registrationDeadline
  function isEventStillOpen(registrationDeadline) {
    if (!registrationDeadline) return true; // Náº¿u khÃ´ng cÃ³ háº¡n thÃ¬ máº·c Ä‘á»‹nh cÃ²n háº¡n
    const deadline = new Date(registrationDeadline);
    const now = new Date();
    return deadline >= now;
  }

  // Format ngÃ y
  function formatDate(iso) {
    if (!iso) return 'ChÆ°a xÃ¡c Ä‘á»‹nh';
    const d = new Date(iso);
    return `${d.getDate().toString().padStart(2,'0')}/${(d.getMonth()+1).toString().padStart(2,'0')}/${d.getFullYear()}`;
  }

  // Render card sá»± kiá»‡n - ÄÃƒ Sá»¬A 2 Lá»–I
  function renderEventCard(event) {
    // Láº¥y tÃªn tá»• chá»©c tá»« include náº¿u cÃ³, fallback vá» 'ChÆ°a xÃ¡c Ä‘á»‹nh'
    const orgName = event.Organization?.name || event.organizationName || 'ChÆ°a xÃ¡c Ä‘á»‹nh';

    const isOpen = isEventStillOpen(event.registrationDeadline);
    const statusText = isOpen ? 'CÃ²n háº¡n' : 'Háº¿t háº¡n';
    const statusClass = isOpen ? 'approved' : 'disapproved';

    const card = document.createElement('div');
    card.className = 'content-card';

    card.innerHTML = `
      <div class="content-image">
        <img src="${event.image || 'https://via.placeholder.com/400x250?text=No+Image'}" alt="${event.name}">
      </div>
      <div class="content-info">
        <div class="date">
          <p>${event.name}</p>
          <div class="status-badge ${statusClass}">${statusText}</div>
        </div>
        <div class="event-info">
          <p>${event.description || 'ChÆ°a cÃ³ mÃ´ táº£ sá»± kiá»‡n.'}</p>
          <p>â° ${formatDate(event.startTime)}</p>
          <p>ğŸ“ ${event.location || 'ChÆ°a xÃ¡c Ä‘á»‹nh'}</p>
          <p>ğŸ¢ ${orgName}</p>
        </div>
        <a class="dki" href="${event.registrationLink || '#'}" target="_blank">ÄÄƒng kÃ½</a>
      </div>
    `;
    return card;
  }

  // Load sá»± kiá»‡n tá»« tab "ÄÃ£ táº¡o" vÃ  "ÄÃ£ duyá»‡t"
  async function loadVisibleEvents() {
    const container = document.getElementById('events-container');
    if (!container) return;

    container.innerHTML = '<p style="text-align:center; color:#888; grid-column:1/-1; padding:60px;">Äang táº£i danh sÃ¡ch sá»± kiá»‡n...</p>';

    try {
      const res = await fetch(EVENTS_API);
      if (!res.ok) throw new Error('Lá»—i server');

      const allEvents = await res.json();

      // Chá»‰ láº¥y created vÃ  approved
      const visibleEvents = allEvents.filter(e => 
        e.status === 'created' || 
        e.status === 'approved'
      );

      container.innerHTML = '';

      if (visibleEvents.length === 0) {
        container.innerHTML = '<p style="text-align:center; color:#888; grid-column:1/-1; padding:80px;">Hiá»‡n chÆ°a cÃ³ sá»± kiá»‡n nÃ o.</p>';
        return;
      }

      visibleEvents.forEach(event => {
        container.appendChild(renderEventCard(event));
      });

    } catch (err) {
      console.error('Lá»—i load sá»± kiá»‡n:', err);
      container.innerHTML = '<p style="text-align:center; color:#c00; grid-column:1/-1;">KhÃ´ng táº£i Ä‘Æ°á»£c danh sÃ¡ch sá»± kiá»‡n.</p>';
    }
  }

  // Load Máº¡ng xÃ£ há»™i
  async function loadSocialMedias() {
    const container = document.getElementById('social-media-col');
    if (!container) return;

    container.innerHTML = '<h3>Máº¡ng xÃ£ há»™i</h3><p style="color:#888; font-style:italic;">Äang táº£i...</p>';

    try {
      const res = await fetch(SOCIAL_API);
      if (!res.ok) throw new Error('Lá»—i');

      const data = await res.json();
      let list = '<ul>';
      if (data.length === 0) {
        list += '<li style="color:#888;">ChÆ°a cÃ³ máº¡ng xÃ£ há»™i</li>';
      } else {
        data.forEach(item => {
          list += `<li><a href="${item.link}" target="_blank" rel="noopener noreferrer">${item.name}</a></li>`;
        });
      }
      list += '</ul>';

      container.innerHTML = '<h3>Máº¡ng xÃ£ há»™i</h3>' + list;
    } catch (err) {
      container.innerHTML = '<h3>Máº¡ng xÃ£ há»™i</h3><p style="color:#c00;">Lá»—i táº£i dá»¯ liá»‡u</p>';
    }
  }

  // Load ThÃ´ng tin liÃªn láº¡c
  async function loadContactInfo() {
    try {
      const res = await fetch(CONTACT_API);
      if (!res.ok) throw new Error('Lá»—i');

      const data = await res.json();
      document.getElementById('footer-email').textContent = data.email || 'ChÆ°a cÃ³';
      document.getElementById('footer-phone').textContent = data.phone || 'ChÆ°a cÃ³';
      document.getElementById('footer-address').textContent = data.address || 'ChÆ°a cÃ³';
    } catch (err) {
      document.getElementById('contact-info-col').innerHTML = '<h3>ThÃ´ng tin liÃªn láº¡c</h3><p style="color:#c00;">Lá»—i táº£i dá»¯ liá»‡u</p>';
    }
  }

  // Cháº¡y khi load trang
  document.addEventListener('DOMContentLoaded', () => {
    loadVisibleEvents();
    loadSocialMedias();
    loadContactInfo();
  });
</script>

</body>
</html>


