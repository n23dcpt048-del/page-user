<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Trang S·ª± Ki·ªán</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="user.css">
  <link rel="stylesheet" href="qlsk.css">
</head>
<body>
<header class="user-header">
  <div class="container">
    <h1>Event Portal (USER PAGE)</h1>
     </div>
</header>

<main class="user-main">
  <h2>Danh s√°ch s·ª± ki·ªán</h2>

  <section class="admin-card-wrapper">
    <div class="event-card" id="events-container">
      <p style="text-align:center; color:#888; grid-column:1/-1; padding:60px;">
        ƒêang t·∫£i danh s√°ch s·ª± ki·ªán...
      </p>
    </div>
  </section>
</main>

<footer>
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <h3>Tr·ª• s·ªü ch√≠nh</h3>
        <p>S·ªë 122 Ho√†ng Qu·ªëc Vi·ªát, ph∆∞·ªùng Nghƒ©a ƒê√¥, th√†nh ph·ªë H√† N·ªôi.</p>
        <p>C∆° s·ªü ƒë√†o t·∫°o t·∫°i H√† N·ªôi<br>S·ªë 964 Ti·∫øn Ph√∫, ph∆∞·ªùng H√† ƒê√¥ng, th√†nh ph·ªë H√† N·ªôi.</p>
      </div>

      <div class="footer-section" id="social-media-col">
        <h3>M·∫°ng x√£ h·ªôi</h3>
        <p style="color:#888; font-style:italic;">ƒêang t·∫£i...</p>
      </div>

      <div class="footer-section">
        <h3>H·ªçc vi·ªán c∆° s·ªü t·∫°i TP H·ªì Ch√≠ Minh</h3>
        <p>S·ªë 11 Nguy·ªÖn ƒê√¨nh Chi·ªÉu, ph∆∞·ªùng S√†i G√≤n, Th√†nh ph·ªë H·ªì Ch√≠ Minh.</p>
        <p>C∆° s·ªü ƒë√†o t·∫°o t·∫°i TP H·ªì Ch√≠ Minh<br>S·ªë 97 Nam Thi·ªán, ph∆∞·ªùng TƒÉng Nh∆°n Ph√∫, th√†nh ph·ªë H·ªì Ch√≠ Minh.</p>
      </div>

      <div class="footer-section" id="contact-info-col">
        <h3>Th√¥ng tin li√™n l·∫°c</h3>
        <ul>
          <li>üìß Email: <span id="footer-email">ƒêang t·∫£i...</span></li>
          <li>üìû S·ªë ƒëi·ªán tho·∫°i: <span id="footer-phone">ƒêang t·∫£i...</span></li>
          <li>üìç ƒê·ªãa ch·ªâ: <span id="footer-address">ƒêang t·∫£i...</span></li>
        </ul>
      </div>
    </div>

    <div class="footer-bottom">
      <p>&copy; 2025 H·ªçc Vi·ªán C√¥ng Ngh·ªá B∆∞u Ch√≠nh Vi·ªÖn Th√¥ng. T·∫•t c·∫£ c√°c quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
    </div>
  </div>
</footer>

<script>
  const API_BASE = 'https://test4-7cop.onrender.com';
  const EVENTS_API = `${API_BASE}/api/events`;
  const SOCIAL_API = `${API_BASE}/api/social-medias`;
  const CONTACT_API = `${API_BASE}/api/contact`;

  // Ki·ªÉm tra s·ª± ki·ªán c√≤n h·∫°n hay h·∫øt h·∫°n d·ª±a tr√™n registrationDeadline
  function isEventStillOpen(registrationDeadline) {
    if (!registrationDeadline) return true; // N·∫øu kh√¥ng c√≥ h·∫°n th√¨ m·∫∑c ƒë·ªãnh c√≤n h·∫°n
    const deadline = new Date(registrationDeadline);
    const now = new Date();
    return deadline >= now;
  }

  // Format ng√†y
  function formatDate(iso) {
    if (!iso) return 'Ch∆∞a x√°c ƒë·ªãnh';
    const d = new Date(iso);
    return `${d.getDate().toString().padStart(2,'0')}/${(d.getMonth()+1).toString().padStart(2,'0')}/${d.getFullYear()}`;
  }

  // Render card s·ª± ki·ªán - ƒê√É S·ª¨A 2 L·ªñI
  function renderEventCard(event) {
    // L·∫•y t√™n t·ªï ch·ª©c t·ª´ include n·∫øu c√≥, fallback v·ªÅ 'Ch∆∞a x√°c ƒë·ªãnh'
    const orgName = event.Organization?.name || event.organizationName || 'Ch∆∞a x√°c ƒë·ªãnh';

    const isOpen = isEventStillOpen(event.registrationDeadline);
    const statusText = isOpen ? 'C√≤n h·∫°n' : 'H·∫øt h·∫°n';
    const statusClass = isOpen ? 'approved' : 'disapproved';

    const card = document.createElement('div');
    card.className = 'content-card';

    card.innerHTML = `
      <div class="content-image">
        <img src="${event.image || 'https://via.placeholder.com/400x250?text=No+Image'}" alt="${event.name}">
      </div>
      <div class="content-info">
        <div class="date">
          <p>${event.name}</p>
          <div class="status-badge ${statusClass}">${statusText}</div>
        </div>
        <div class="event-info">
          <p>${event.description || 'Ch∆∞a c√≥ m√¥ t·∫£ s·ª± ki·ªán.'}</p>
          <p>‚è∞ ${formatDate(event.startTime)}</p>
          <p>üìç ${event.location || 'Ch∆∞a x√°c ƒë·ªãnh'}</p>
          <p>üè¢ ${orgName}</p>
        </div>
        <a class="dki" href="${event.registrationLink || '#'}" target="_blank">ƒêƒÉng k√Ω</a>
      </div>
    `;
    return card;
  }

  // Load s·ª± ki·ªán t·ª´ tab "ƒê√£ t·∫°o" v√† "ƒê√£ duy·ªát"
  async function loadVisibleEvents() {
    const container = document.getElementById('events-container');
    if (!container) return;

    container.innerHTML = '<p style="text-align:center; color:#888; grid-column:1/-1; padding:60px;">ƒêang t·∫£i danh s√°ch s·ª± ki·ªán...</p>';

    try {
      const res = await fetch(EVENTS_API);
      if (!res.ok) throw new Error('L·ªói server');

      const allEvents = await res.json();

      // Ch·ªâ l·∫•y created v√† approved
      const visibleEvents = allEvents.filter(e => 
        e.status === 'created' || 
        e.status === 'approved'
      );

      container.innerHTML = '';

      if (visibleEvents.length === 0) {
        container.innerHTML = '<p style="text-align:center; color:#888; grid-column:1/-1; padding:80px;">Hi·ªán ch∆∞a c√≥ s·ª± ki·ªán n√†o.</p>';
        return;
      }

      visibleEvents.forEach(event => {
        container.appendChild(renderEventCard(event));
      });

    } catch (err) {
      console.error('L·ªói load s·ª± ki·ªán:', err);
      container.innerHTML = '<p style="text-align:center; color:#c00; grid-column:1/-1;">Kh√¥ng t·∫£i ƒë∆∞·ª£c danh s√°ch s·ª± ki·ªán.</p>';
    }
  }

  // Load M·∫°ng x√£ h·ªôi
  async function loadSocialMedias() {
    const container = document.getElementById('social-media-col');
    if (!container) return;

    container.innerHTML = '<h3>M·∫°ng x√£ h·ªôi</h3><p style="color:#888; font-style:italic;">ƒêang t·∫£i...</p>';

    try {
      const res = await fetch(SOCIAL_API);
      if (!res.ok) throw new Error('L·ªói');

      const data = await res.json();
      let list = '<ul>';
      if (data.length === 0) {
        list += '<li style="color:#888;">Ch∆∞a c√≥ m·∫°ng x√£ h·ªôi</li>';
      } else {
        data.forEach(item => {
          list += `<li><a href="${item.link}" target="_blank" rel="noopener noreferrer">${item.name}</a></li>`;
        });
      }
      list += '</ul>';

      container.innerHTML = '<h3>M·∫°ng x√£ h·ªôi</h3>' + list;
    } catch (err) {
      container.innerHTML = '<h3>M·∫°ng x√£ h·ªôi</h3><p style="color:#c00;">L·ªói t·∫£i d·ªØ li·ªáu</p>';
    }
  }

  // Load Th√¥ng tin li√™n l·∫°c
  async function loadContactInfo() {
    try {
      const res = await fetch(CONTACT_API);
      if (!res.ok) throw new Error('L·ªói');

      const data = await res.json();
      document.getElementById('footer-email').textContent = data.email || 'Ch∆∞a c√≥';
      document.getElementById('footer-phone').textContent = data.phone || 'Ch∆∞a c√≥';
      document.getElementById('footer-address').textContent = data.address || 'Ch∆∞a c√≥';
    } catch (err) {
      document.getElementById('contact-info-col').innerHTML = '<h3>Th√¥ng tin li√™n l·∫°c</h3><p style="color:#c00;">L·ªói t·∫£i d·ªØ li·ªáu</p>';
    }
  }

  // Ch·∫°y khi load trang
  document.addEventListener('DOMContentLoaded', () => {
    loadVisibleEvents();
    loadSocialMedias();
    loadContactInfo();
  });
</script>

</body>
</html>
